---
import { AnimatedDonutChart } from "../../components/PieChart";
import { PROJECTS } from "../../data/projects.ts";
import Layout from "../../layouts/Layout.astro";

const { slug } = Astro.params;

const project = PROJECTS.find((p) => p.slug === slug);

if (!project) {
    throw new Error(`Proyecto no encontrado para slug: ${slug}`);
}

const { title, description, image } = project;

export function getStaticPaths() {
    return PROJECTS.map((project) => ({
        params: { slug: project.slug },
    }));
}
---

<Layout title={title} description="Detalle de Proyecto">
    <main
        class="px-4 scroll-m-20 w-full mx-auto container lg:max-w-4xl md:max-w-2xl"
    >
        <h2
            class="text-3xl font-semibold pt-32 flex gap-x-3 items-center text-gray-100"
        >
            {title}
        </h2>

        <!-- Carousel Container -->
        <div
            id="default-carousel"
            class="relative w-full max-w-96 mx-auto h-screen"
            data-carousel="slide"
        >
            <!-- Carousel wrapper -->
            <div class="relative h-full overflow-hidden rounded-lg md:h-full">
                <!-- Item 1 -->
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img
                        src="/projects/apordom/apordom-3.webp"
                        class="absolute block w-full h-full object-cover -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"
                        alt="..."
                    />
                </div>
                <!-- Item 2 -->
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img
                        src="/projects/apordom/apordom-2.webp"
                        class="absolute block w-full h-full object-cover -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"
                        alt="..."
                    />
                </div>
                <!-- Item 3 -->
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img
                        src="/projects/apordom/apordom-1.webp"
                        class="absolute block w-full h-full object-cover -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"
                        alt="..."
                    />
                </div>
            </div>

            <!-- Slider indicators -->
            <div
                class="absolute z-30 flex -translate-x-1/2 bottom-5 left-1/2 space-x-3 rtl:space-x-reverse"
            >
                <button
                    type="button"
                    class="w-3 h-3 rounded-full"
                    aria-current="true"
                    aria-label="Slide 1"
                    data-carousel-slide-to="0"></button>
                <button
                    type="button"
                    class="w-3 h-3 rounded-full"
                    aria-current="false"
                    aria-label="Slide 2"
                    data-carousel-slide-to="1"></button>
                <button
                    type="button"
                    class="w-3 h-3 rounded-full"
                    aria-current="false"
                    aria-label="Slide 3"
                    data-carousel-slide-to="2"></button>
            </div>

            <!-- Slider controls -->
            <button
                type="button"
                class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none"
                data-carousel-prev
            >
                <span
                    class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none"
                >
                    <svg
                        class="w-4 h-4 text-white dark:text-gray-800 rtl:rotate-180"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 6 10"
                    >
                        <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5 1 1 5l4 4"></path>
                    </svg>
                    <span class="sr-only">Previous</span>
                </span>
            </button>
            <button
                type="button"
                class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none"
                data-carousel-next
            >
                <span
                    class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none"
                >
                    <svg
                        class="w-4 h-4 text-white dark:text-gray-800 rtl:rotate-180"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 6 10"
                    >
                        <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="m1 9 4-4-4-4"></path>
                    </svg>
                    <span class="sr-only">Next</span>
                </span>
            </button>
        </div>
    </main>

    <p class="text-lg text-gray-600 dark:text-gray-300">{description}</p>
    <AnimatedDonutChart client:load />
</Layout>

<!-- Add the script to initialize the carousel (can also use Flowbite JS or custom JS) -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const prevBtn = document.querySelector("[data-carousel-prev]");
        const nextBtn = document.querySelector("[data-carousel-next]");
        const items = document.querySelectorAll("[data-carousel-item]");

        let currentIndex = 0;

        function showItem(index) {
            items.forEach((item, i) => {
                item.classList.add("hidden");
                if (i === index) {
                    item.classList.remove("hidden");
                }
            });
        }

        prevBtn.addEventListener("click", () => {
            currentIndex =
                currentIndex === 0 ? items.length - 1 : currentIndex - 1;
            showItem(currentIndex);
        });

        nextBtn.addEventListener("click", () => {
            currentIndex =
                currentIndex === items.length - 1 ? 0 : currentIndex + 1;
            showItem(currentIndex);
        });

        // Show the first item initially
        showItem(currentIndex);
    });
</script>
